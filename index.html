<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

<!-- iPhone tam ekran (Ana Ekrana Ekle iÃ§in) -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<title>Baby Sound Colors</title>

<style>
html, body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  background:#000;
  -webkit-tap-highlight-color:transparent;
  touch-action:none;
}

/* ðŸ”´ EKRANI TAMAMEN KAPLAR â€“ BOÅžLUK YOK */
#screen{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  background:#000;
}
</style>
</head>

<body>
<div id="screen"></div>

<script>
/* ðŸŽ¨ SADECE SENÄ°N SEÃ‡TÄ°ÄžÄ°N SOFT RENKLER */
const PALETTE = [
  "#A23E48","#F4E285","#A7C6ED","#F5F3F0",
  "#CF7041","#E5C5BD","#E2A55E","#5E718B","#96AA9A","#B4BFC5",
  "#F2EEE2","#7EC3CE","#F2D78C","#25767A","#A0A072","#345E4F",
  "#E9E6DA","#E2A18A","#DDB068","#BCC6AB","#8BA4B5","#896450"
];

const NOTES = [220, 247, 294, 330, 392, 440];

const screen = document.getElementById("screen");
let lastColor = -1;

/* ðŸ”Š SES MOTORU */
let ctx, master;

function audio(){
  if(!ctx){
    ctx = new (window.AudioContext || window.webkitAudioContext)();

    const comp = ctx.createDynamicsCompressor();
    comp.threshold.value = -20;
    comp.knee.value = 16;
    comp.ratio.value = 2.6;
    comp.attack.value = 0.003;
    comp.release.value = 0.1;

    master = ctx.createGain();
    master.gain.value = 0.95;

    master.connect(comp);
    comp.connect(ctx.destination);
  }
  if(ctx.state === "suspended") ctx.resume();
}

/* ðŸ”¢ RENK â†’ KARAKTER */
function hash(hex){
  let h=0;
  for(let i=0;i<hex.length;i++) h=(h*31+hex.charCodeAt(i))>>>0;
  return h;
}

/* ðŸŽµ NET & PARLAK SES */
function play(freq, vol, delay=0){
  audio();
  const t = ctx.currentTime + delay;

  const hp = ctx.createBiquadFilter();
  hp.type = "highpass";
  hp.frequency.value = 320;

  const lp = ctx.createBiquadFilter();
  lp.type = "lowpass";
  lp.frequency.value = 8500;

  const g = ctx.createGain();
  g.gain.setValueAtTime(0.0006, t);
  g.gain.exponentialRampToValueAtTime(vol, t+0.01);
  g.gain.exponentialRampToValueAtTime(0.0006, t+0.35);

  const o = ctx.createOscillator();
  o.type = "sine";
  o.frequency.value = freq;

  o.connect(hp);
  hp.connect(lp);
  lp.connect(g);
  g.connect(master);

  o.start(t);
  o.stop(t+0.4);

  o.onended = ()=>{ o.disconnect(); hp.disconnect(); lp.disconnect(); g.disconnect(); };
}

/* âš¡ HIZLI DOKUNMA = ARPEJ */
const taps=[];
const WINDOW=520;
const FAST=3;
const STEP=0.065;
const SWING=0.018;
const ARP=[0, STEP+SWING, STEP*2, STEP*3+SWING];

function fastMode(now){
  while(taps.length && now-taps[0]>WINDOW) taps.shift();
  return taps.length>=FAST;
}

function next(){
  let i=lastColor;
  while(i===lastColor) i=Math.floor(Math.random()*PALETTE.length);
  lastColor=i;

  const color = PALETTE[i];
  screen.style.background=color;

  const h = hash(color);
  const base = NOTES[h % NOTES.length];
  const freq = base * Math.pow(2, (((h>>3)%3)-1)*0.5);
  const vol = 0.08;

  const now = performance.now();
  taps.push(now);

  if(!fastMode(now)){
    play(freq, vol);
  }else{
    [1,1.19,1.5,2].forEach((r,i)=>{
      play(freq*r, vol*0.9, ARP[i]);
    });
  }

  navigator.vibrate?.(12);
}

window.addEventListener("pointerdown", e=>{
  e.preventDefault();
  next();
},{passive:false});
</script>
</body>
</html>
